(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[711],{5347:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/transacciones",function(){return r(2566)}])},2566:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(7568),a=r(797),s=r(7582),c=r(5893),o=r(7294),i=r(7119),l=r(8387);let d=(0,l.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),u=(0,l.Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var m=r(9638),x=r(6615),f=r(1203);function p(e){var t=e.isOpen,r=e.onClose,n=e.onApprove,a=e.onReject,s=e.transactionData,i=(0,o.useRef)(null),l=function(){if(i.current){var e=i.current.scrollHeight;i.current.scrollTop=.23*e}};return((0,o.useEffect)(function(){if(t&&i.current){var e=setTimeout(function(){l()},200);return function(){return clearTimeout(e)}}},[t]),t)?(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Revisar Transacci\xf3n"}),(0,c.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,c.jsx)(f.Z,{className:"h-5 w-5"})})]}),(0,c.jsxs)("div",{className:"p-6",children:[(0,c.jsx)("div",{className:"flex justify-center mb-6",children:(0,c.jsx)("div",{ref:i,className:"w-full max-w-2xl h-96 bg-gray-100 rounded-lg border-2 border-gray-200 overflow-auto",children:(0,c.jsx)("img",{src:s.support_url||"https://images.ctfassets.net/h9i30ml9c3lu/7qyJQDzrFkrLUEHLjTFNfW/ab29db116d437148473d2e2f67463dfb/NEQUI.jpg",alt:"Comprobante de transacci\xf3n",className:"w-4/5 h-auto rounded-lg mx-auto",style:{transform:"scale(0.8)"},onLoad:l,onError:function(e){var t,r=e.target;r.style.display="none";var n=r.parentElement;n&&(n.innerHTML='\n                      <div class="text-center p-4">\n                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">\n                          <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n                          </svg>\n                        </div>\n                        <p class="text-sm text-gray-600 font-medium mb-3">Comprobante de transacci\xf3n</p>\n                        <div class="bg-gray-50 rounded-lg p-3 border">\n                          <div class="text-xs text-gray-600 space-y-1">\n                            <p><strong>Para:</strong> '.concat(s.cliente,"</p>\n                            <p><strong>Monto:</strong> ").concat((t=s.monto,new Intl.NumberFormat("es-CO",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t)),"</p>\n                            <p><strong>Referencia:</strong> ").concat(s.referencia,"</p>\n                          </div>\n                        </div>\n                      </div>\n                    "))}})})}),(0,c.jsx)("div",{className:"space-y-3 mb-6",children:(0,c.jsx)("div",{className:"text-center",children:(0,c.jsx)("p",{className:"text-sm text-gray-600",children:"\xbfDeseas aprobar o rechazar esta transacci\xf3n?"})})}),(0,c.jsxs)("div",{className:"flex space-x-3",children:[(0,c.jsx)("button",{onClick:n,className:"flex-1 bg-green-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",children:"Aprobar"}),(0,c.jsx)("button",{onClick:a,className:"flex-1 bg-red-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:"Rechazar"})]})]})]})}):null}function h(e){var t,r=e.data,l=e.searchPlaceholder,f=e.itemsPerPage,h=void 0===f?10:f,g=(e.onTransactionRemove,e.onTransactionAction),y=(0,o.useState)(""),v=y[0],b=y[1],j=(0,o.useState)(1),w=j[0],N=j[1],C=(0,o.useState)(null),_=C[0],k=C[1],E=(0,o.useState)("asc"),S=E[0],T=E[1],A=(0,o.useState)(null),L=A[0],M=A[1],R=(0,o.useState)(!1),Z=R[0],P=R[1],O=(0,o.useState)(null),D=O[0],F=O[1],I=(0,o.useState)(new Set),z=I[0],H=I[1],U=(0,o.useMemo)(function(){return v?r.filter(function(e){return e.referencia.toLowerCase().includes(v.toLowerCase())||e.cliente.toLowerCase().includes(v.toLowerCase())||e.estado.toLowerCase().includes(v.toLowerCase())||e.monto.toString().includes(v)}):r},[r,v]),B=(0,o.useMemo)(function(){return _?(0,a.Z)(U).sort(function(e,t){var r=e[_],n=t[_];return("monto"===_&&(r=Number(r),n=Number(n)),r<n)?"asc"===S?-1:1:r>n?"asc"===S?1:-1:0}):U},[U,_,S]),q=Math.ceil(B.length/h),G=(w-1)*h,J=G+h,Q=B.slice(G,J),W=function(e){_===e?T("asc"===S?"desc":"asc"):(k(e),T("asc"))},X=function(e){N(e)},V=function(e){var t="status-badge";switch(e){case"Aceptada":case"approved":return"".concat(t," status-accepted");case"Abierta":case"open":return"".concat(t," status-open");case"Borrador":case"draft":default:return"".concat(t," status-draft");case"Pendiente":case"pending":return"".concat(t," status-pending");case"Completada":case"completed":return"".concat(t," status-completed");case"Cancelada":case"rejected":return"".concat(t," status-cancelled");case"reviewed":return"".concat(t," status-reviewed")}},K=function(){P(!1),M(null)},Y=function(){L&&g&&g(L.id,"approve"),K()},$=function(){L&&g&&g(L.id,"reject"),K()},ee=(t=(0,n.Z)(function(e){var t,r;return(0,s.__generator)(this,function(n){switch(n.label){case 0:if(!g)return[3,6];F(e.id),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,g(e.id,"review")];case 2:if("disableReview"===(t=n.sent()).outcome)return H(function(t){return new Set(t).add(e.id)}),[2];if("removed"===t.outcome)return[2];return M(e),P(!0),[3,5];case 3:return r=n.sent(),console.error("Error al revisar transacci\xf3n:",r),[3,5];case 4:return F(null),[7];case 5:return[3,7];case 6:M(e),P(!0),n.label=7;case 7:return[2]}})}),function(e){return t.apply(this,arguments)});return(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,c.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)(i.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,c.jsx)("input",{type:"text",placeholder:void 0===l?"Buscar transacciones...":l,value:v,onChange:function(e){return b(e.target.value)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})}),(0,c.jsx)("div",{className:"overflow-x-auto",children:(0,c.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 table-stripe",children:[(0,c.jsx)("thead",{className:"bg-gray-50",children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:function(){return W("monto")},children:(0,c.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,c.jsx)("span",{children:"MONTO"}),"monto"===_&&(0,c.jsx)("span",{className:"text-primary-600",children:"asc"===S?"↑":"↓"})]})}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:function(){return W("referencia")},children:(0,c.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,c.jsx)("span",{children:"REFERENCIA"}),"referencia"===_&&(0,c.jsx)("span",{className:"text-primary-600",children:"asc"===S?"↑":"↓"})]})}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:function(){return W("cliente")},children:(0,c.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,c.jsx)("span",{children:"CLIENTE"}),"cliente"===_&&(0,c.jsx)("span",{className:"text-primary-600",children:"asc"===S?"↑":"↓"})]})}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:function(){return W("fecha")},children:(0,c.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,c.jsx)("span",{children:"FECHA"}),"fecha"===_&&(0,c.jsx)("span",{className:"text-primary-600",children:"asc"===S?"↑":"↓"})]})}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ACCIONES"})]})}),(0,c.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:Q.map(function(e,t){var r;return(0,c.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[(r=e.monto,new Intl.NumberFormat("es-CO",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(r))," USD"]}),(0,c.jsx)(d,{className:"h-3 w-3 text-gray-400"}),(0,c.jsx)("span",{className:V(e.estado),children:e.estado})]})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.referencia}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.cliente}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.fecha||e.fechaCreacion}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,c.jsx)("button",{onClick:function(){return ee(e)},disabled:D===e.id||z.has(e.id),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:D===e.id?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600 mr-2"}),"Procesando..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(u,{className:"h-4 w-4 mr-2"}),"Revisar"]})})})]},e.id)})})]})}),(0,c.jsxs)("div",{className:"px-6 py-3 border-t border-gray-200 flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"text-sm text-gray-700",children:["Mostrando ",G+1," a ",Math.min(J,B.length)," de ",B.length," resultados"]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,c.jsx)("button",{onClick:function(){return X(w-1)},disabled:1===w,className:"p-2 rounded-md border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,c.jsx)(m.Z,{className:"h-4 w-4"})}),(0,c.jsx)("div",{className:"flex items-center space-x-1",children:Array.from({length:q},function(e,t){return t+1}).map(function(e){return(0,c.jsx)("button",{onClick:function(){return X(e)},className:"\n                  px-3 py-1 text-sm rounded-md\n                  ".concat(w===e?"bg-primary-600 text-white":"text-gray-700 hover:bg-gray-100","\n                "),children:e},e)})}),(0,c.jsx)("button",{onClick:function(){return X(w+1)},disabled:w===q,className:"p-2 rounded-md border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,c.jsx)(x.Z,{className:"h-4 w-4"})})]})]}),L&&(0,c.jsx)(p,{isOpen:Z,onClose:K,onApprove:Y,onReject:$,transactionData:{id:L.id,referencia:L.referencia,monto:L.monto,cliente:L.cliente,support_url:L.support_url}})]})}var g=r(8694),y=r(8969),v=r(2116);function b(){var e=(0,o.useState)([]),t=e[0],r=e[1],i=(0,o.useState)(!1),l=(i[0],i[1]),d=(0,o.useState)(!1),u=d[0],m=d[1],x=(0,o.useRef)(null),f=function(){m(!u)};(0,o.useEffect)(function(){var e;return(e=(0,n.Z)(function(){var e,t,n,a,c,o,i,d;return(0,s.__generator)(this,function(t){switch(t.label){case 0:l(!0),t.label=1;case 1:return t.trys.push([1,7,8,9]),e="http://localhost:8080/api/",[4,fetch("".concat(e,"transactions"),{method:"GET",headers:{"Content-Type":"application/json"}})];case 2:if(!(n=t.sent()).ok)return[3,4];return[4,n.json()];case 3:return r((Array.isArray(a=t.sent())?a:[]).map(function(e){return{id:e.id,referencia:e.reference,monto:e.amount,fecha:e.date,estado:e.status,cliente:e.destination_account,vencimiento:"",fechaCreacion:e.date,payment_method:e.payment_method,amount:e.amount,destination_account:e.destination_account,source_account:e.source_account,beneficiary:e.beneficiary,whatsapp_phone:e.whatsapp_phone,support_url:e.support_url,date:e.date,userId:e.userId,createdAt:e.createdAt,updatedAt:e.updatedAt}}).filter(function(e){return"pending"===String(e.estado||"").toLowerCase()})),[3,6];case 4:return[4,n.text().catch(function(){return n.statusText})];case 5:i=t.sent(),console.error("Error al cargar transacciones iniciales:",i),t.label=6;case 6:return[3,9];case 7:return d=t.sent(),console.error("Error al cargar transacciones iniciales:",d),[3,9];case 8:return l(!1),[7];case 9:return[2]}})}),function(){return e.apply(this,arguments)})(),!function(){try{var e="".concat("http://localhost:8080/api/","sse");x.current=new EventSource(e),x.current.onmessage=function(e){try{var t=JSON.parse(e.data);console.log("Evento recibido:",t);var n={id:t._id,referencia:t.reference,monto:t.amount,fecha:t.date,estado:t.status,cliente:t.destination_account,vencimiento:"",fechaCreacion:t.date,payment_method:t.payment_method,amount:t.amount,destination_account:t.destination_account,source_account:t.source_account,beneficiary:t.beneficiary,whatsapp_phone:t.whatsapp_phone,support_url:t.support_url,date:t.date,userId:t.userId,createdAt:t.createdAt,updatedAt:t.updatedAt},s=String(n.estado||"").toLowerCase();if("pending"!==s&&"review"!==s){r(function(e){return e.filter(function(e){return e.id!==n.id})});return}r(function(e){return e.some(function(e){return e.id===n.id})?e.map(function(e){return e.id===n.id?n:e}):[n].concat((0,a.Z)(e))})}catch(c){console.error("Error al parsear datos SSE:",c),console.log("Datos raw recibidos:",e.data)}},x.current.onerror=function(e){console.error("Error en conexi\xf3n SSE:",e)},x.current.onopen=function(){console.log("Conexi\xf3n SSE establecida con:",e)}}catch(t){console.error("Error al configurar SSE:",t)}}(),function(){x.current&&(x.current.close(),console.log("Conexi\xf3n SSE cerrada"))}},[]);var p,b=function(e){r(function(t){return t.filter(function(t){return t.id!==e})})},j=(p=(0,n.Z)(function(e,t){var n,a,c,o,i,l;return(0,s.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),n="http://localhost:8080/api/",[4,fetch("".concat(n,"transactions/").concat(e,"/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"}})];case 1:if((c=a.sent()).ok){if(console.log("Transacci\xf3n ".concat(t," exitosamente")),"approve"===t||"reject"===t)return r(function(t){return t.filter(function(t){return t.id!==e})}),[2,{outcome:"removed"}];return[2,{outcome:"ok"}]}if(409!==c.status)return[3,3];return[4,c.text()];case 2:if((o=a.sent().toLowerCase()).includes("approved"))return r(function(t){return t.filter(function(t){return t.id!==e})}),[2,{outcome:"removed"}];if(o.includes("rejected"))return r(function(t){return t.filter(function(t){return t.id!==e})}),[2,{outcome:"removed"}];if(o.includes("review"))return[2,{outcome:"disableReview"}];throw Error("409: ".concat(o));case 3:return[4,c.text().catch(function(){return c.statusText})];case 4:throw i=a.sent(),console.error("Error al ".concat(t," la transacci\xf3n:"),i),Error("Error al ".concat(t," la transacci\xf3n: ").concat(i));case 5:throw l=a.sent(),console.error("Error al ".concat(t," la transacci\xf3n:"),l),l;case 6:return[2]}})}),function(e,t){return p.apply(this,arguments)});return(0,c.jsx)(v.Z,{children:(0,c.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,c.jsx)(g.Z,{isOpen:u,onToggle:f}),(0,c.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,c.jsx)(y.Z,{onMenuClick:f,title:"Transacciones"}),(0,c.jsx)("main",{className:"flex-1 p-6",children:(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Gesti\xf3n de Transacciones"}),(0,c.jsx)("p",{className:"text-gray-600",children:"Administra las transacciones del sistema"})]}),(0,c.jsxs)("div",{className:"text-sm text-gray-500",children:["Total: ",t.length," transacciones"]})]}),0===t.length?(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[(0,c.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,c.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),(0,c.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay transacciones"}),(0,c.jsx)("p",{className:"text-gray-500",children:"Las transacciones aparecer\xe1n aqu\xed cuando lleguen del sistema."})]}):(0,c.jsx)(h,{data:t,searchPlaceholder:"Buscar por referencia, cliente, estado o monto...",itemsPerPage:10,onTransactionRemove:b,onTransactionAction:j})]})})]})]})})}}},function(e){e.O(0,[903,103,877,774,888,179],function(){return e(e.s=5347)}),_N_E=e.O()}]);